---
title: Simulating runs in a coin toss sequence
author: Charlotte Wickham
---

```{r setup, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, results = "hide")
library(tidyverse)
set.seed(181871)
```

awkldnawkljd 
## Motivating question

A random sequence of H's and T's is generated by tossing a fair coin $n = 20$ times.  What's the expected length of the longest run of consecutive heads or tails?

*Taken from Tijms, Henk. Probability: A Lively Introduction. Cambridge University Press, 2017*

* How does the expected length of the longest run vary with the number of coinflips, $n$? 

* How does the answer change if the coin isn't fair?

* How does the variance of our estimate vary with the number of simulations we do?


## Some useful functions

```{r}
sim_coin_tosses <- function(n_sims, n, prob){
  # Simulates n_sims sequences of n coin tosses
  # with heads occuring with probability prob
  # fair, by default
  rerun(n_sims, 
    rbinom(n, size = 1, prob = prob))
}

max_run_length <- function(x){
  # Finds length of longest run in x
  max(rle(x)$lengths)
}

sim_run_lengths <- function(n_sims, n, prob = 0.5){
  # Returns length of longest run in n_sims sequences
  # of coin toss sequences of  n flips, where each flip
  # has prob p of being heads.
  sim_coin_tosses(n_sims, n, prob) %>% 
    map_dbl(~ max_run_length(.))
}
```

## Simulation setup

```{r}
simulation_params_big <- list(
  n = c(10, 20, 50, 100), 
  prob = seq(0.1, 0.9, by = 0.2),
  n_sims = c(100, 1000, 10000)
)

runs_big <- cross_df(simulation_params_big)
```

## Simulation

```{r}
runs_big <- runs_big %>% 
  mutate(
    run_lengths = pmap(list(n = n, prob = prob, n_sims = n_sims), 
      sim_run_lengths)) 
```


## Summarization 
```{r}
runs_big <- runs_big %>% 
  mutate(
    mean_max_length = map_dbl(run_lengths, mean),
    sd_max_length = map_dbl(run_lengths, sd)
  )
```

## Results 
```{r}
runs_big %>% 
  ggplot(aes(x = n, y = mean_max_length, color = factor(prob))) +
    geom_pointrange(aes(
      ymin = mean_max_length - 1.96*sd_max_length/sqrt(n_sims),
      ymax = mean_max_length + 1.96*sd_max_length/sqrt(n_sims))) +
    geom_line()  +
  facet_wrap(~ n_sims)
```

```{bash}
git config --global user.email "cwickham@gmail.com"
git config --global user.name "Charlotte Wickham"
git config --global credential.helper 'cache --timeout 3600'
```

